<!DOCTYPE html><html lang="en"> <!-- The Head v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Adding Logic | Play Framework Tutorial</title><meta name="generator" content="Jekyll v4.0.0" /><meta property="og:title" content="Adding Logic" /><meta name="author" content="Dvir" /><meta property="og:locale" content="en_US" /><meta name="description" content="We will add some logic and refactor in the next sections. We will build a dish menu for our users." /><meta property="og:description" content="We will add some logic and refactor in the next sections. We will build a dish menu for our users." /><link rel="canonical" href="https://dvirf.github.io/play-tutorial/posts/adding-logic/" /><meta property="og:url" content="https://dvirf.github.io/play-tutorial/posts/adding-logic/" /><meta property="og:site_name" content="Play Framework Tutorial" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-04-07T01:00:22+03:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Adding Logic" /><meta name="twitter:site" content="@playframework" /><meta name="twitter:creator" content="@Dvir" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"headline":"Adding Logic","mainEntityOfPage":{"@type":"WebPage","@id":"https://dvirf.github.io/play-tutorial/posts/adding-logic/"},"url":"https://dvirf.github.io/play-tutorial/posts/adding-logic/","author":{"@type":"Person","name":"Dvir"},"description":"We will add some logic and refactor in the next sections. We will build a dish menu for our users.","dateModified":"2020-04-07T01:00:22+03:00","datePublished":"2020-04-07T01:00:22+03:00","@type":"BlogPosting","@context":"https://schema.org"}</script> <!-- The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps Generated by: https://www.favicon-generator.org/ v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT license --><link rel="shortcut icon" href="/play-tutorial/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/play-tutorial/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/play-tutorial/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/play-tutorial/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/play-tutorial/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/play-tutorial/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/play-tutorial/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/play-tutorial/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/play-tutorial/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/play-tutorial/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/play-tutorial/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/play-tutorial/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/play-tutorial/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/play-tutorial/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/play-tutorial/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/play-tutorial/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/play-tutorial/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/play-tutorial/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/play-tutorial/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/play-tutorial/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin><link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" as="style" href="/play-tutorial/assets/css/main.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/play-tutorial/assets/css/main.css"><link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"><link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/popper.js@1.15.0/dist/umd/popper.min.js" integrity="sha256-fTuUgtT7O2rqoImwjrhDgbXTKUwyxxujIMRIK7TbuNU=" crossorigin> <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script> <script> window.jQuery || document.write('<script src="/play-tutorial/assets/lib/jquery-3.4.1.min.js"><\/script>'); </script> <script src="https://cdn.jsdelivr.net/npm/popper.js@1.15.0/dist/umd/popper.min.js" integrity="sha256-fTuUgtT7O2rqoImwjrhDgbXTKUwyxxujIMRIK7TbuNU=" crossorigin="anonymous" async></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha256-5+02zu5UULQkO7w1GIr6vftCgMfFdZcAHeDtFnKZsBs=" crossorigin="anonymous" async></script> <script src="/play-tutorial/assets/js/dist/commons.js" async></script> <script src="/play-tutorial/assets/js/dist/timeago.min.js" async></script><link rel="preload" as="style" href="/play-tutorial/assets/css/post.css"><link rel="preload" as="style" href="/play-tutorial/assets/css/syntax.css"><link rel="stylesheet" href="/play-tutorial/assets/css/post.css"><link rel="stylesheet" href="/play-tutorial/assets/css/syntax.css"><link rel="preload" as="style" href="/play-tutorial/assets/lib/bootstrap-toc-1.0.1/bootstrap-toc.min.css"><link rel="preload" as="script" href="/play-tutorial/assets/lib/bootstrap-toc-1.0.1/bootstrap-toc.min.js"><link rel="stylesheet" href="/play-tutorial/assets/lib/bootstrap-toc-1.0.1/bootstrap-toc.min.css" /> <script src="/play-tutorial/assets/lib/bootstrap-toc-1.0.1/bootstrap-toc.min.js" async></script> <script src="/play-tutorial/assets/js/dist/toc.min.js" async></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"> <!-- The Side Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/play-tutorial/" alt="avatar"> <img src="/play-tutorial/assets/img/sample/avatar.png"> </a></div><div class="profile-text mt-3"><div id="site-title"> <a href="/play-tutorial/">Play Framework Tutorial</a></div><div id="site-subtitle" class="font-italic">Build a Play Framework application from scratch</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/play-tutorial/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-3 mr-3 unloaded"></i> <span>HOME</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/play-tutorial/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-3 mr-3 unloaded"></i> <span>ABOUT</span> </a></li></ul></div><div class="contact d-flex justify-content-around mt-4"> <a href="https://www.linkedin.com/in/dvir-faivel-82b737b3" target="_blank"> <i class="fab fa-linkedin-in"></i> </a> <a href="https://github.com/dvirf1/play-tutorial" target="_blank"> <i class="fab fa-github-alt"></i> </a> <!-- <a href="https://twitter.com/playframework" target="_blank"> <i class="fab fa-twitter"></i> </a> --> <a href="https://www.reddit.com/r/scala/" target="_blank"> <i class="fab fa-reddit-alien"></i> </a> <a href="https://www.playframework.com/" target="_blank"> <i class="fas fa-play"></i> </a></div></div><div id="main-wrapper"> <!-- The Top Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/play-tutorial/"> Posts </a> </span> <span>Adding Logic</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <a href="javascript:;">Cancel</a></div></div><div id="main"> <!-- Fixed kramdown code highlight rendering: https://github.com/penibelst/jekyll-compress-html/issues/101 https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901 --><div class="row"> <!-- Define the liquid date formats. v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Adding Logic</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago" data-toggle="tooltip" title="Tue, Apr 7, 2020, 1:00 AM +0300" hidden="true"> Apr 7, 2020 <i class="unloaded">2020-04-07T01:00:22+03:00</i> </span> on <a href='/play-tutorial/categories/controller/'>Controller</a></div></div><div class="post-content"><p>We will add some logic and refactor in the next sections.<br /> We will build a dish menu for our users.</p><h2 id="defining-routes">Defining Routes</h2><p>First, let’s add three new routes to the <code class="highlighter-rouge">conf/routes</code> file:</p><div class="highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>GET     /dishes            com.example.playground.dish.DishController.allDishes
GET     /dishes/:name      com.example.playground.dish.DishController.findDish(name: String)
POST    /dishes            com.example.playground.dish.DishController.createDish
</pre></table></code></div></div><h2 id="creating-a-model">Creating a Model</h2><p>Now let’s add a VO (<a href="https://en.wikipedia.org/wiki/Value_object">Value Object</a>) that will represent a dish.<br /> VOs are represented in Scala with a case class.<br /> Add a case class <code class="highlighter-rouge">com.example.playground.dish.Dish</code> with name, description and price:</p><div class="language-scala highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">case</span> <span class="k">class</span> <span class="nc">Dish</span><span class="o">(</span>
  <span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
  <span class="n">description</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
  <span class="n">price</span><span class="k">:</span> <span class="kt">Double</span>
<span class="o">)</span>
</pre></table></code></div></div><h2 id="add-a-controller">Add a controller</h2><p>Add a controller <code class="highlighter-rouge">com.example.playground.dish.DishController</code> that implements the API above:</p><div class="language-scala highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre><td class="rouge-code"><pre><span class="k">package</span> <span class="nn">com.example.playground.dish</span>

<span class="k">import</span> <span class="nn">play.api.mvc.</span><span class="o">{</span><span class="nc">AbstractController</span><span class="o">,</span> <span class="nc">Action</span><span class="o">,</span> <span class="nc">AnyContent</span><span class="o">,</span> <span class="nc">ControllerComponents</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">scala.collection.mutable</span>

<span class="k">import</span> <span class="nn">play.api.libs.json.</span><span class="o">{</span><span class="nc">Json</span><span class="o">,</span> <span class="nc">OWrites</span><span class="o">}</span>

<span class="k">class</span> <span class="nc">DishController</span><span class="o">(</span>
  <span class="n">controllerComponents</span><span class="k">:</span> <span class="kt">ControllerComponents</span><span class="o">,</span>
  <span class="n">dishes</span><span class="k">:</span> <span class="kt">mutable.Set</span><span class="o">[</span><span class="kt">Dish</span><span class="o">]</span>
<span class="o">)</span> <span class="k">extends</span> <span class="nc">AbstractController</span><span class="o">(</span><span class="n">controllerComponents</span><span class="o">)</span> <span class="o">{</span>

  <span class="k">def</span> <span class="nf">allDishes</span><span class="o">()</span><span class="k">:</span> <span class="kt">Action</span><span class="o">[</span><span class="kt">AnyContent</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Action</span> <span class="o">{</span>
    <span class="k">implicit</span> <span class="k">val</span> <span class="nv">dishWrites</span><span class="k">:</span> <span class="kt">OWrites</span><span class="o">[</span><span class="kt">Dish</span><span class="o">]</span> <span class="k">=</span> <span class="nv">Json</span><span class="o">.</span><span class="py">writes</span><span class="o">[</span><span class="kt">Dish</span><span class="o">]</span>
    <span class="nc">Ok</span><span class="o">(</span><span class="nv">Json</span><span class="o">.</span><span class="py">toJson</span><span class="o">(</span><span class="n">dishes</span><span class="o">))</span>
  <span class="o">}</span>

  <span class="k">def</span> <span class="nf">findDish</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Action</span><span class="o">[</span><span class="kt">AnyContent</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Action</span> <span class="o">{</span>
    <span class="k">val</span> <span class="nv">maybeDish</span> <span class="k">=</span> <span class="nv">dishes</span><span class="o">.</span><span class="py">find</span><span class="o">(</span><span class="n">dish</span> <span class="k">=&gt;</span> <span class="nv">dish</span><span class="o">.</span><span class="py">name</span> <span class="o">==</span> <span class="n">name</span><span class="o">)</span> <span class="c1">// can be shortened to `dishes.find(_.name == name)`</span>
    <span class="n">maybeDish</span> <span class="k">match</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nc">Some</span><span class="o">(</span><span class="n">dish</span><span class="o">)</span> <span class="k">=&gt;</span>
        <span class="k">implicit</span> <span class="k">val</span> <span class="nv">dishWrites</span> <span class="k">=</span> <span class="nv">Json</span><span class="o">.</span><span class="py">writes</span><span class="o">[</span><span class="kt">Dish</span><span class="o">]</span>
        <span class="nc">Ok</span><span class="o">(</span><span class="nv">Json</span><span class="o">.</span><span class="py">toJson</span><span class="o">(</span><span class="n">dish</span><span class="o">))</span>
      <span class="k">case</span> <span class="nc">None</span> <span class="k">=&gt;</span>
        <span class="nc">NotFound</span><span class="o">(</span><span class="s">"could not find the specified dish"</span><span class="o">)</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="k">def</span> <span class="nf">createDish</span><span class="o">()</span><span class="k">:</span> <span class="kt">Action</span><span class="o">[</span><span class="kt">AnyContent</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Action</span> <span class="o">{</span> <span class="n">request</span> <span class="k">=&gt;</span>
    <span class="nv">request</span><span class="o">.</span><span class="py">body</span><span class="o">.</span><span class="py">asJson</span> <span class="k">match</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nc">Some</span><span class="o">(</span><span class="n">jsValue</span><span class="o">)</span> <span class="k">=&gt;</span>
        <span class="k">val</span> <span class="nv">name</span> <span class="k">=</span> <span class="o">(</span><span class="n">jsValue</span> <span class="o">\</span> <span class="s">"name"</span><span class="o">).</span><span class="py">as</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>
        <span class="k">val</span> <span class="nv">description</span> <span class="k">=</span> <span class="o">(</span><span class="n">jsValue</span> <span class="o">\</span> <span class="s">"description"</span><span class="o">).</span><span class="py">as</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>
        <span class="k">val</span> <span class="nv">price</span> <span class="k">=</span> <span class="o">(</span><span class="n">jsValue</span> <span class="o">\</span> <span class="s">"price"</span><span class="o">).</span><span class="py">as</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span>
        <span class="k">val</span> <span class="nv">dishToCreate</span> <span class="k">=</span> <span class="nc">Dish</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">description</span><span class="o">,</span> <span class="n">price</span><span class="o">)</span>
        <span class="nf">if</span> <span class="o">(</span><span class="nv">dishes</span><span class="o">.</span><span class="py">contains</span><span class="o">(</span><span class="n">dishToCreate</span><span class="o">))</span>
          <span class="nc">Ok</span><span class="o">(</span><span class="n">s</span><span class="s">"Dish $name already exists"</span><span class="o">)</span>
        <span class="k">else</span> <span class="o">{</span>
          <span class="n">dishes</span> <span class="o">+=</span> <span class="n">dishToCreate</span>
          <span class="nc">Ok</span><span class="o">(</span><span class="n">s</span><span class="s">"Added dish $name to the dish list"</span><span class="o">)</span>
        <span class="o">}</span>
      <span class="k">case</span> <span class="nc">None</span> <span class="k">=&gt;</span>
        <span class="nc">BadRequest</span><span class="o">(</span><span class="s">"Expected json as the body, but got something else"</span><span class="o">)</span>
    <span class="o">}</span>
  <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><p>The code will be explained shortly.</p><h2 id="wiring-the-dependencies">Wiring the dependencies</h2><p>This controller stores the dishes in-memory, in a mutable set which you will now inject: Try to compile the code by running <code class="highlighter-rouge">compile</code> in the sbt shell. The compilation will fail, but the <code class="highlighter-rouge">conf/routes</code> file will now be compile to a new <code class="highlighter-rouge">Routes</code> class with a constructor that requires <code class="highlighter-rouge">DishController</code>.<br /> Create a new instance of the controller in <code class="highlighter-rouge">AppComponents</code> and provide it to the constructor:</p><div class="language-scala highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="k">import</span> <span class="nn">scala.collection.mutable</span>
<span class="k">import</span> <span class="nn">com.example.playground.dish.</span><span class="o">{</span><span class="nc">Dish</span><span class="o">,</span> <span class="nc">DishController</span><span class="o">}</span>
<span class="c1">// ..</span>
<span class="k">val</span> <span class="nv">dishes</span> <span class="k">=</span> <span class="nv">mutable</span><span class="o">.</span><span class="py">Set</span><span class="o">(</span>
  <span class="nc">Dish</span><span class="o">(</span><span class="s">"Avocado Sandwich"</span><span class="o">,</span> <span class="s">"Whole grain bread with Brie cheese, tomatoes and avocado"</span><span class="o">,</span> <span class="mi">10</span><span class="o">),</span>
  <span class="nc">Dish</span><span class="o">(</span><span class="s">"Ice Cream"</span><span class="o">,</span> <span class="s">"Chocolate + Vanilla Ice Cream"</span><span class="o">,</span> <span class="mi">8</span><span class="o">)</span>
<span class="o">)</span>
<span class="k">lazy</span> <span class="k">val</span> <span class="nv">dishController</span><span class="k">:</span> <span class="kt">DishController</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DishController</span><span class="o">(</span><span class="n">controllerComponents</span><span class="o">,</span> <span class="n">dishes</span><span class="o">)</span>
<span class="k">override</span> <span class="k">def</span> <span class="nf">router</span><span class="k">:</span> <span class="kt">Router</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Routes</span><span class="o">(</span><span class="n">httpErrorHandler</span><span class="o">,</span> <span class="n">homeController</span><span class="o">,</span> <span class="n">dishController</span><span class="o">,</span> <span class="n">assets</span><span class="o">)</span>
</pre></table></code></div></div><p>Lastly, create a new package, <code class="highlighter-rouge">com.example.playground.home</code> and move <code class="highlighter-rouge">app/HomeController</code> to this package. Change the package name at <code class="highlighter-rouge">conf/routes</code> and adjust the import at <code class="highlighter-rouge">com.example.playground.configuration.components.AppComponents</code>.</p><h2 id="invoking-the-api">Invoking the API</h2><p>You can now run the server by running <code class="highlighter-rouge">run</code> in the sbt-shell.<br /> Let’s invoke the API:</p><ul><li>Get all the existing dishes by browsing to <a href="http://localhost:9000/dishes">http://localhost:9000/dishes</a> . You should see a json with 2 dishes.</li><li>Find a dish by browsing to <a href="http://localhost:9000/dishes/Avocado%20Sandwich">http://localhost:9000/dishes/Avocado%20Sandwich</a></li><li>Create a dish, e.g by using your <a href="https://insomnia.rest/">favorite rest client</a> or using <code class="highlighter-rouge">curl</code> in your terminal:<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>curl <span class="nt">--request</span> POST <span class="se">\</span>
<span class="nt">--url</span> http://localhost:9000/dishes <span class="se">\</span>
<span class="nt">--header</span> <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
<span class="nt">--data</span> <span class="s1">'{
  "name": "Karaka Spicy Ramen",
  "description": "Pork tonkotsu broth, thin noodles, pork belly chashu",
  "price": 16
}'</span>
</pre></table></code></div></div></li></ul><p>Experiment by trying to add a dish twice or finding a dish that does not exist.</p><h2 id="how-the-controller-works">How the controller works</h2><h3 id="actions">Actions</h3><p>Each method is implemented as an <code class="highlighter-rouge">Action</code>, that takes</p><ul><li>A block of code that evaluates to a <code class="highlighter-rouge">Result</code> (such as <code class="highlighter-rouge">Ok</code>), like in <code class="highlighter-rouge">allDishes</code> and <code class="highlighter-rouge">findDish</code>, or takes:</li><li>A function from a request to a <code class="highlighter-rouge">Result</code>, like in <code class="highlighter-rouge">createDish</code>.</li></ul><h3 id="serializing-json-manually">Serializing JSON manually</h3><p>In <code class="highlighter-rouge">allDishes</code> we would like to serialize the dishes to json, and a return a result like:</p><div class="language-json highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Ice Cream"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Chocolate + Vanilla Ice Cream"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"price"</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Avocado Sandwich"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Whole grain bread with Brie cheese, tomatoes and avocado"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"price"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></pre></table></code></div></div><p>To do so, we need to serialize the <code class="highlighter-rouge">dishes</code> instance, which has a type <code class="highlighter-rouge">mutable.Set[Dish]</code>.<br /> Play has json encoders (which serialize classes to json) for basic types, such as String, Int, Boolean.<br /> The scala compiler can create an encoder for collection types as well, such as List[A], Set[A], mutable.Set[A], etc. <strong>as long as there is an encoder for A in scope</strong>.</p><h4 id="serializing-supported-types">Serializing supported types</h4><p>This means that if we wanted to serialize an object of type <code class="highlighter-rouge">mutable.Set[String]</code> all we had to do is pass it to the toJson method like so:</p><div class="language-scala highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="k">val</span> <span class="nv">setOfStrings</span> <span class="k">=</span> <span class="nv">mutable</span><span class="o">.</span><span class="py">Set</span><span class="o">(</span><span class="s">"hello"</span><span class="o">,</span> <span class="s">"world"</span><span class="o">)</span>
<span class="nv">Json</span><span class="o">.</span><span class="py">toJson</span><span class="o">(</span><span class="n">setOfStrings</span><span class="o">)</span>
</pre></table></code></div></div><h4 id="serializing-custom-types">Serializing custom types</h4><p>However, we would like to serialize an object of type <code class="highlighter-rouge">mutable.Set[Dish]</code> so we need to create an encoder for the <code class="highlighter-rouge">Dish</code> class.<br /> We could have created an encoder for dish in the following cumbersome way:</p><div class="language-scala highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">implicit</span> <span class="k">val</span> <span class="nv">dishWritesCumbersome</span><span class="k">:</span> <span class="kt">Writes</span><span class="o">[</span><span class="kt">Dish</span><span class="o">]</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Writes</span><span class="o">[</span><span class="kt">Dish</span><span class="o">]</span> <span class="o">{</span>
      <span class="k">def</span> <span class="nf">writes</span><span class="o">(</span><span class="n">dish</span><span class="k">:</span> <span class="kt">Dish</span><span class="o">)</span> <span class="k">=</span> <span class="nv">Json</span><span class="o">.</span><span class="py">obj</span><span class="o">(</span>
        <span class="s">"name"</span> <span class="o">-&gt;</span> <span class="nv">dish</span><span class="o">.</span><span class="py">name</span><span class="o">,</span>
        <span class="s">"description"</span> <span class="o">-&gt;</span> <span class="nv">dish</span><span class="o">.</span><span class="py">description</span><span class="o">,</span>
        <span class="s">"price"</span> <span class="o">-&gt;</span> <span class="nv">dish</span><span class="o">.</span><span class="py">price</span>
      <span class="o">)</span>
    <span class="o">}</span>
</pre></table></code></div></div><p>But this requires too much boilerplate, which means that this is too error prone. e.g, we can easily mix up the description field: <code class="highlighter-rouge">"description" -&gt; dish.name</code>.</p><h3 id="serializing-json-with-macros">Serializing JSON with macros</h3><p>Since all the members in the Dish case class have encoders we can use the macro <code class="highlighter-rouge">Json.writes[Dish]</code> to automatically create an encoder for it.<br /> If a member of Dish didn’t have an encoder, but was itself composed of members that have encoders, then we could build an encoder for it in the same way. e.g, Imagine a different version of Dish, that specifies the chef:</p><div class="language-scala highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">case</span> <span class="k">class</span> <span class="nc">Chef</span><span class="o">(</span><span class="n">first</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">last</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">DishV2</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">description</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">price</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">chef</span><span class="k">:</span> <span class="kt">Chef</span><span class="o">)</span>
<span class="c1">// later on in the code:</span>
<span class="k">implicit</span> <span class="k">val</span> <span class="nv">chefWrites</span><span class="k">:</span> <span class="kt">OWrites</span><span class="o">[</span><span class="kt">Chef</span><span class="o">]</span> <span class="k">=</span> <span class="nv">Json</span><span class="o">.</span><span class="py">writes</span><span class="o">[</span><span class="kt">Chef</span><span class="o">]</span>
<span class="k">implicit</span> <span class="k">val</span> <span class="nv">dishV2Writes</span><span class="k">:</span> <span class="kt">OWrites</span><span class="o">[</span><span class="kt">DishV2</span><span class="o">]</span> <span class="k">=</span> <span class="nv">Json</span><span class="o">.</span><span class="py">writes</span><span class="o">[</span><span class="kt">DishV2</span><span class="o">]</span>
</pre></table></code></div></div><p>Check the signature of <code class="highlighter-rouge">toJson</code> method by clicking with the cursor on <code class="highlighter-rouge">toJson</code> and using <code class="highlighter-rouge">ctrl + j</code>, which will open the quick documentation pane (use <code class="highlighter-rouge">ctrl</code> and not <code class="highlighter-rouge">cmd</code>. if you changed your key map, use double <code class="highlighter-rouge">shift</code>, that is bound in all the key maps to search everywhere, and search for <code class="highlighter-rouge">quick documentation</code>).</p><p>We can see that the signature is</p><div class="language-scala highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">toJson</span><span class="o">[</span><span class="kt">T</span><span class="o">](</span><span class="n">o</span><span class="k">:</span> <span class="kt">T</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">tjs</span><span class="k">:</span> <span class="kt">Writes</span><span class="o">[</span><span class="kt">T</span><span class="o">])</span><span class="k">:</span> <span class="kt">JsValue</span>
</pre></table></code></div></div><p>toJson has a type parameter T and accepts 2 parameter lists, each containing a single parameter.<br /> In scala, a method with multiple parameters can have a single parameter list or multiple parameter lists. e.g</p><div class="language-scala highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">method1</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">b</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="c1">// single parameter list that contains 2 parameters</span>
<span class="k">def</span> <span class="nf">method2</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">String</span><span class="o">)(</span><span class="n">b</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="c1">// 2 parameter lists, each containing a single parameter</span>

<span class="nf">method1</span><span class="o">(</span><span class="s">"hello"</span><span class="o">,</span> <span class="s">" world"</span><span class="o">)</span>
<span class="nf">method2</span><span class="o">(</span><span class="s">"hello"</span><span class="o">)(</span><span class="s">" world"</span><span class="o">)</span>
</pre></table></code></div></div><p>The signature of toJson means that it can accept an object <code class="highlighter-rouge">o</code> of any type <code class="highlighter-rouge">T</code> if we (or the scala compiler) also pass it a json seralizer instance <code class="highlighter-rouge">tjs</code> of type <code class="highlighter-rouge">Writes[T]</code>.<br /> The type parameter T in our case is inferred as <code class="highlighter-rouge">mutable.Set[Dish]</code>, so these 2 calls are equivalent:</p><div class="language-scala highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">Json</span><span class="o">.</span><span class="py">toJson</span><span class="o">(</span><span class="n">dishes</span><span class="o">)</span>
<span class="nv">Json</span><span class="o">.</span><span class="py">toJson</span><span class="o">[</span><span class="kt">mutable.Set</span><span class="o">[</span><span class="kt">Dish</span><span class="o">]](</span><span class="n">dishes</span><span class="o">)</span>
</pre></table></code></div></div><p>We are not passing this method the parameters for the second parameter list.<br /> Normally, the Scala compiler emit an error and say that we are missing an argument list:</p><div class="language-scala highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre> <span class="nf">method2</span><span class="o">(</span><span class="s">"hello"</span><span class="o">)</span> <span class="c1">// compile time error: missing argument list for method method2</span>
</pre></table></code></div></div><p>However, the second argument list for <code class="highlighter-rouge">toJson</code> is marked with implicit, which means that <code class="highlighter-rouge">tjs</code> is an implicit parameter of type <code class="highlighter-rouge">Writes[mutable.Set[Dish]]</code>, and before the compiler would give up, it will try to find an implicit value of that type, or to create one recursively.</p><p>In our case, the compiler can provide an implicit value of type <code class="highlighter-rouge">Writes[mutable.Set[Dish]]</code> since it is given an implicit value of type <code class="highlighter-rouge">Writes[Dish]</code>.</p><p>Note: Implicit value just serves as a canonical instance for its type. e.g the implicit value for <code class="highlighter-rouge">Ordering[Int]</code> just orders integers from low to high.</p><p>The <code class="highlighter-rouge">findDish</code> method searches for a dish with the same name and returns it in a similar manner, with a <code class="highlighter-rouge">Writes[Dish]</code> instance.<br /> e.g the following code is equivalent:</p><div class="language-scala highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">Json</span><span class="o">.</span><span class="py">toJson</span><span class="o">(</span><span class="n">dish</span><span class="o">)</span>
<span class="nv">Json</span><span class="o">.</span><span class="py">toJson</span><span class="o">[</span><span class="kt">Dish</span><span class="o">](</span><span class="n">dish</span><span class="o">)</span>
<span class="nv">Json</span><span class="o">.</span><span class="py">toJson</span><span class="o">[</span><span class="kt">Dish</span><span class="o">](</span><span class="n">dish</span><span class="o">)(</span><span class="n">dishWrites</span><span class="o">)</span>
</pre></table></code></div></div><p>The reason that we don’t get an error on the first and second call is that before the compiler throws an error that the second argument list was not supplied, it tries to find an implicit value of type <code class="highlighter-rouge">Write[Dish]</code> in scope, and succeeds since there is such instance that is marked with the implicit keyword.<br /> Try to delete this keyword and check the error:</p><div class="language-scala highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="c1">// implicit val dishWrites = Json.writes[Dish]</span>
<span class="k">val</span> <span class="nv">dishWrites</span> <span class="k">=</span> <span class="nv">Json</span><span class="o">.</span><span class="py">writes</span><span class="o">[</span><span class="kt">Dish</span><span class="o">]</span>
<span class="nv">Json</span><span class="o">.</span><span class="py">toJson</span><span class="o">(</span><span class="n">dish</span><span class="o">)</span> <span class="c1">// error: No Json serializer found for type com.example.playground.dish.Dish. Try to implement an implicit Writes or Format for this type</span>
</pre></table></code></div></div><h3 id="deserializing-json-explanation-of-the-initial-implementation">Deserializing JSON: explanation of the initial implementation</h3><p>The <code class="highlighter-rouge">createDish</code> method is implemented by providing the Action a function from a request to a result.<br /> All we had to do to achieve this is to add <code class="highlighter-rouge">request =&gt;</code> in the beginning of the body.</p><p>Click with the cursor on <code class="highlighter-rouge">request</code> and open quick documentation (ctrl+j). Notice that the type of request is <code class="highlighter-rouge">Request[AnyContent]</code>, which means that the body can be of any type (we will improve this later. we want the body to be of type Dish, since it contains a json of type Dish).</p><p>Here, we are manually creating a Dish instance by traversing the json object, looking for each field by name.<br /> This is error prone and unfortunately code like this is common.<br /> Sometimes the logic of deserializing the json can be nested inside several functions, and when we try to understand what a controller is doing by reading its signature we don’t even know how the body looks like.</p><h3 id="deserializing-json-take-2">Deserializing JSON: take 2</h3><p>Let’s change the code under the first <code class="highlighter-rouge">case</code> clause to try to class-up the json automatically to Dish:</p><div class="language-scala highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">createDish</span><span class="o">()</span><span class="k">:</span> <span class="kt">Action</span><span class="o">[</span><span class="kt">AnyContent</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Action</span> <span class="o">{</span> <span class="n">request</span> <span class="k">=&gt;</span>
  <span class="nv">request</span><span class="o">.</span><span class="py">body</span><span class="o">.</span><span class="py">asJson</span> <span class="k">match</span> <span class="o">{</span>
    <span class="k">case</span> <span class="nc">Some</span><span class="o">(</span><span class="n">jsValue</span><span class="o">)</span> <span class="k">=&gt;</span>
      <span class="k">implicit</span> <span class="k">val</span> <span class="nv">dishReads</span> <span class="k">=</span> <span class="nv">Json</span><span class="o">.</span><span class="py">reads</span><span class="o">[</span><span class="kt">Dish</span><span class="o">]</span>
      <span class="nv">Json</span><span class="o">.</span><span class="py">fromJson</span><span class="o">[</span><span class="kt">Dish</span><span class="o">](</span><span class="n">jsValue</span><span class="o">)</span> <span class="k">match</span> <span class="o">{</span>
        <span class="k">case</span> <span class="nc">JsSuccess</span><span class="o">(</span><span class="n">dishToCreate</span><span class="o">,</span> <span class="n">path</span><span class="o">)</span> <span class="k">=&gt;</span>
          <span class="nf">if</span> <span class="o">(</span><span class="nv">dishes</span><span class="o">.</span><span class="py">contains</span><span class="o">(</span><span class="n">dishToCreate</span><span class="o">))</span>
            <span class="nc">Ok</span><span class="o">(</span><span class="n">s</span><span class="s">"Dish ${dishToCreate.name} already exists"</span><span class="o">)</span>
          <span class="k">else</span> <span class="o">{</span>
            <span class="n">dishes</span> <span class="o">+=</span> <span class="n">dishToCreate</span>
            <span class="nc">Ok</span><span class="o">(</span><span class="n">s</span><span class="s">"Added dish ${dishToCreate.name} to the dish list"</span><span class="o">)</span>
          <span class="o">}</span>
        <span class="k">case</span> <span class="nc">JsError</span><span class="o">(</span><span class="n">errors</span><span class="o">)</span> <span class="k">=&gt;</span>
          <span class="nc">BadRequest</span><span class="o">(</span><span class="s">"Expected dish json, but got another json"</span><span class="o">)</span>
      <span class="o">}</span>
    <span class="k">case</span> <span class="nc">None</span> <span class="k">=&gt;</span>
      <span class="nc">BadRequest</span><span class="o">(</span><span class="s">"Expected json as the body, but got something else"</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><h3 id="deserializing-json-take-3">Deserializing JSON: take 3</h3><p>Let’s use Play to parse the body to json for us. We will do so by providing a json parser as the first argument (and in a new argument list) to Action:</p><div class="language-scala highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">createDish</span><span class="o">()</span><span class="k">:</span> <span class="kt">Action</span><span class="o">[</span><span class="kt">JsValue</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Action</span><span class="o">(</span><span class="nv">parse</span><span class="o">.</span><span class="py">json</span><span class="o">)</span> <span class="o">{</span> <span class="n">request</span> <span class="k">=&gt;</span>
  <span class="k">val</span> <span class="nv">jsValue</span><span class="k">:</span> <span class="kt">JsValue</span> <span class="o">=</span> <span class="nv">request</span><span class="o">.</span><span class="py">body</span>
  <span class="k">implicit</span> <span class="k">val</span> <span class="nv">dishReads</span> <span class="k">=</span> <span class="nv">Json</span><span class="o">.</span><span class="py">reads</span><span class="o">[</span><span class="kt">Dish</span><span class="o">]</span>
  <span class="nv">Json</span><span class="o">.</span><span class="py">fromJson</span><span class="o">[</span><span class="kt">Dish</span><span class="o">](</span><span class="n">jsValue</span><span class="o">)</span> <span class="k">match</span> <span class="o">{</span>
    <span class="k">case</span> <span class="nc">JsSuccess</span><span class="o">(</span><span class="n">dishToCreate</span><span class="o">,</span> <span class="n">path</span><span class="o">)</span> <span class="k">=&gt;</span>
      <span class="nf">if</span> <span class="o">(</span><span class="nv">dishes</span><span class="o">.</span><span class="py">contains</span><span class="o">(</span><span class="n">dishToCreate</span><span class="o">))</span>
        <span class="nc">Ok</span><span class="o">(</span><span class="n">s</span><span class="s">"Dish ${dishToCreate.name} already exists"</span><span class="o">)</span>
      <span class="k">else</span> <span class="o">{</span>
        <span class="n">dishes</span> <span class="o">+=</span> <span class="n">dishToCreate</span>
        <span class="nc">Ok</span><span class="o">(</span><span class="n">s</span><span class="s">"Added dish ${dishToCreate.name} to the dish list"</span><span class="o">)</span>
      <span class="o">}</span>
    <span class="k">case</span> <span class="nc">JsError</span><span class="o">(</span><span class="n">errors</span><span class="o">)</span> <span class="k">=&gt;</span>
      <span class="nc">BadRequest</span><span class="o">(</span><span class="s">"Expected dish json, but got another json"</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>Now we no longer need to check if the body can be parsed to json or not.<br /> Our server will automatically return a 400 Bad Request if the body is not a json.<br /> Another benefit is that now a new developer that reads the signature of <code class="highlighter-rouge">createDish</code> can tell that its body has to be json, since it returns <code class="highlighter-rouge">Action[JsValue]</code>.<br /> You can also verify (with quick documentation) that the type of request is now <code class="highlighter-rouge">Request[JsValue]</code>.<br /> However, we still need to check if the json is a Dish json or another json (e.g it may be a person json:<br /> <code class="highlighter-rouge">{ "name": "alice", "age": 20 }</code>).</p><h3 id="deserializing-json-take-4">Deserializing JSON: take 4</h3><p>Let’s refactor and make the dishReads to be a member of the controller, and pass it to the body parser:</p><div class="language-scala highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="k">implicit</span> <span class="k">val</span> <span class="nv">dishReads</span><span class="k">:</span> <span class="kt">Reads</span><span class="o">[</span><span class="kt">Dish</span><span class="o">]</span> <span class="k">=</span> <span class="nv">Json</span><span class="o">.</span><span class="py">reads</span><span class="o">[</span><span class="kt">Dish</span><span class="o">]</span>

<span class="k">def</span> <span class="nf">createDish</span><span class="o">()</span><span class="k">:</span> <span class="kt">Action</span><span class="o">[</span><span class="kt">Dish</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Action</span><span class="o">(</span><span class="nv">parse</span><span class="o">.</span><span class="py">json</span><span class="o">[</span><span class="kt">Dish</span><span class="o">])</span> <span class="o">{</span> <span class="n">request</span> <span class="k">=&gt;</span>
  <span class="k">val</span> <span class="nv">dishToCreate</span><span class="k">:</span> <span class="kt">Dish</span> <span class="o">=</span> <span class="nv">request</span><span class="o">.</span><span class="py">body</span>
  <span class="nf">if</span> <span class="o">(</span><span class="nv">dishes</span><span class="o">.</span><span class="py">contains</span><span class="o">(</span><span class="n">dishToCreate</span><span class="o">))</span>
    <span class="nc">Ok</span><span class="o">(</span><span class="n">s</span><span class="s">"Dish ${dishToCreate.name} already exists"</span><span class="o">)</span>
  <span class="k">else</span> <span class="o">{</span>
    <span class="n">dishes</span> <span class="o">+=</span> <span class="n">dishToCreate</span>
    <span class="nc">Ok</span><span class="o">(</span><span class="n">s</span><span class="s">"Added dish ${dishToCreate.name} to the dish list"</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>As a note, again, the following code is equivalent:</p><div class="language-scala highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nc">Action</span><span class="o">(</span><span class="nv">parse</span><span class="o">.</span><span class="py">json</span><span class="o">[</span><span class="kt">Dish</span><span class="o">])</span> <span class="c1">// dishReads is passed implicitly</span>
<span class="nc">Action</span><span class="o">(</span><span class="nv">parse</span><span class="o">.</span><span class="py">json</span><span class="o">[</span><span class="kt">Dish</span><span class="o">](</span><span class="n">dishReads</span><span class="o">))</span> <span class="c1">// dishReads is passed explicitly, the type parameter is passed explicitly as Dish</span>
<span class="nc">Action</span><span class="o">(</span><span class="nv">parse</span><span class="o">.</span><span class="py">json</span><span class="o">(</span><span class="n">dishReads</span><span class="o">))</span> <span class="c1">// dishReads is passed explicitly and the type patameter in inferred</span>
</pre></table></code></div></div><p>Now a developer that reads the signature for <code class="highlighter-rouge">createDish</code> can immediately tell that the body is expected to be of type <code class="highlighter-rouge">Dish</code>.<br /> We have come a long way since the first implementation.<br /> Now we just deserialize the request body to the desired type, do some logic, and serialize the result.</p><h3 id="refining-the-signature-of-actions-that-do-not-read-the-request">Refining the signature of actions that do not read the request</h3><p>Lastly, we will change the other actions to have a type signature that conveys that they don’t use the request body (by returning <code class="highlighter-rouge">Action[Unit]</code>).<br /> We can already tell that these methods do not parse the body, since they don’t take the request as a parameter, so choose your preferred implementation:</p><div class="language-scala highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">allDishes</span><span class="o">()</span><span class="k">:</span> <span class="kt">Action</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Action</span><span class="o">(</span><span class="nv">parse</span><span class="o">.</span><span class="py">empty</span><span class="o">)</span> <span class="o">{</span> <span class="k">_</span> <span class="k">=&gt;</span>
  <span class="cm">/* code */</span>
<span class="o">}</span>
 
<span class="k">def</span> <span class="nf">findDish</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Action</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Action</span><span class="o">(</span><span class="nv">parse</span><span class="o">.</span><span class="py">empty</span><span class="o">)</span> <span class="o">{</span> <span class="k">_</span> <span class="k">=&gt;</span>
  <span class="cm">/* code */</span>
<span class="o">}</span>
</pre></table></code></div></div><p>We could have named the parameter of the function literal (from <code class="highlighter-rouge">Request[Unit]</code> to <code class="highlighter-rouge">Result</code>) that we are passing. e.g<br /> <code class="highlighter-rouge">Action(parse.empty) { request =&gt; ... </code> or<br /> <code class="highlighter-rouge">Action(parse.empty) { requestWithUnitBody =&gt; ... </code><br /> We named it <code class="highlighter-rouge">_</code>, which is useful since we are not using it and we have no reason to name it with a special name.</p></div><div class="post-tail text-muted"><div class="mb-4"> <a href="/play-tutorial/tags/controller/" class="post-tag no-text-decoration" >controller</a> <a href="/play-tutorial/tags/action/" class="post-tag no-text-decoration" >action</a> <a href="/play-tutorial/tags/json/" class="post-tag no-text-decoration" >json</a></div></div></div></div><!-- The Pannel on right side (Desktop views) v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="panel-wrapper" class="col-xl-3 pl-2 topbar-down"><div class="access"><div id="access-tags" hidden="true"><h3 data-toc-skip>Trending Tags</h3><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <!-- The trending tags list v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung MIT Licensed --> <a class="post-tag" href="/play-tutorial/tags/compile-time-dependency-injection/">compile time dependency injection</a> <a class="post-tag" href="/play-tutorial/tags/typesafe-config/">typesafe config</a> <a class="post-tag" href="/play-tutorial/tags/json/">json</a> <a class="post-tag" href="/play-tutorial/tags/db-api/">db api</a> <a class="post-tag" href="/play-tutorial/tags/tests/">tests</a> <a class="post-tag" href="/play-tutorial/tags/slf4j/">slf4j</a> <a class="post-tag" href="/play-tutorial/tags/skeleton/">skeleton</a> <a class="post-tag" href="/play-tutorial/tags/scalafmt/">scalafmt</a> <a class="post-tag" href="/play-tutorial/tags/sbt-native-packager/">sbt native packager</a> <a class="post-tag" href="/play-tutorial/tags/pureconfig/">pureconfig</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><h3 data-toc-skip class="pl-3 pt-2">Contents</h3><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="post-extend-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <!-- The related posts of current post. Placed in the bottom of every single post. v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div id="related-posts" class="mt-4 mb-2 mb-sm-4 pb-2" hidden="true"><h3 class="pt-2 mt-1 mb-4" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/circe/"><div class="card-body"> <span class="timeago small"> Apr 7, 2020 <i class="unloaded">2020-04-07T01:00:32+03:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Circe</h3><div class="text-muted small"><p>play-json enabled us to class-up json (deserializing it from string to a case class) and to serialize json with relative ease. Circe (pronounced SUR-see) is yet another JSON library for Scala. It ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/play-tutorial/posts/compile-time-dependency-injection/" class="btn btn-outline-primary"><p>Compile-Time Dependency Injection</p></a> <a href="/play-tutorial/posts/moving-the-logic-to-a-library/" class="btn btn-outline-primary"><p>Moving the logic to a library</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const observer = lozad(); observer.observe(); </script> <!-- The Footer v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="copyright"><p class="mb-0"> © 2020<a href="https://www.linkedin.com/in/dvir-faivel-82b737b3/" class="ml-1">Dvir</a>. <br>Powered by <a href="https://jekyllrb.com" target="_blank">Jekyll</a>, theme by <a href="https://github.com/cotes2020/jekyll-theme-chirpy/">Chirpy</a>.</p></div></footer></div><!-- The Search results v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted">Trending Tags</h4><!-- The trending tags list v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung MIT Licensed --> <a class="post-tag" href="/play-tutorial/tags/compile-time-dependency-injection/">compile time dependency injection</a> <a class="post-tag" href="/play-tutorial/tags/typesafe-config/">typesafe config</a> <a class="post-tag" href="/play-tutorial/tags/json/">json</a> <a class="post-tag" href="/play-tutorial/tags/db-api/">db api</a> <a class="post-tag" href="/play-tutorial/tags/tests/">tests</a> <a class="post-tag" href="/play-tutorial/tags/slf4j/">slf4j</a> <a class="post-tag" href="/play-tutorial/tags/skeleton/">skeleton</a> <a class="post-tag" href="/play-tutorial/tags/scalafmt/">scalafmt</a> <a class="post-tag" href="/play-tutorial/tags/sbt-native-packager/">sbt native packager</a> <a class="post-tag" href="/play-tutorial/tags/pureconfig/">pureconfig</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <!-- The GA snippet v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', '', 'auto'); ga('send', 'pageview'); </script> <!-- Jekyll Simple Search loader v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js" integrity="sha256-qcLR00zq6pJk4je3MLgAri8Nn+ZumUlXgTKR2H/xCY0=" crossorigin="anonymous"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/play-tutorial/assets/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://dvirf.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
